name: INVENTORY_FINAL_BUILD

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    name: Build iOS and Android
    runs-on: macos-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: stable
          flutter-version: 3.19.0
          cache: true

      - name: Install Dependencies
        # Hapa tunaingia ndani ya folder la inventoryscanner kupata pubspec.yaml
        run: |
          cd inventoryscanner
          flutter pub get

      - name: Build Android APK
        run: |
          cd inventoryscanner
          flutter build apk --release

      - name: Build iOS (No Codesign)
        run: |
          cd inventoryscanner
          flutter build ios --release --no-codesign

      - name: Package Artifacts
        run: |
          mkdir -p artifacts
          cp inventoryscanner/build/app/outputs/flutter-apk/app-release.apk artifacts/Inventory-Android.apk
          cd inventoryscanner/build/ios/iphoneos
          zip -r ../../../artifacts/Inventory-iOS.app.zip *.app

      - name: Upload Build
        uses: actions/artifact@v4
        with:
          name: Inventory-Apps
          path: artifacts/